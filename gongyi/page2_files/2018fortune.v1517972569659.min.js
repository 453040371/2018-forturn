function ajaxEx(t, e) {
    var a = GY.Sys.ajax,
        o = GY.Busi.authorize;
    if (t = t || {}, t.data = t.data || {}, e = e || {}, !t.url) throw new Error("缺少参数 `url`");
    t.loginState && (isWX() ? t.data.gysts = o.encodeToken() : t.data.g_tk = o.encodeToken());
    var n = {
        url: t.url,
        data: t.data,
        success: function(i) {
            if (o.ckLogin({ code: i.code, snsapi: "snsapi_userinfo" })) switch (i.code) {
                case 0:
                    var r = t.success || e[0];
                    "function" == typeof r && r(i.data || i);
                    break;
                case 110033:
                    "function" == typeof e[110033] && e[110033](i), setTimeout(function() { a(n) }, 1e3);
                    break;
                default:
                    report(pruneObj({ label: t.label, url: t.url, par: t.data, ret: i, cookie: t.loginState ? document.cookie : null })), "function" == typeof e[i.code] && e[i.code](i), "function" == typeof t.fail && t.fail(i)
            }
        },
        error: function(e, a) { report(pruneObj({ label: t.label, url: t.url, par: t.data, errmsg: a })), "function" == typeof t.error && t.error(e, a) }
    };
    a(n)
}

function isWX() { return "wx" === uClient }

function report(t) {
    var e = Object.keys(t).reduce(function(e, a) { var o = t[a]; return o = o && "object" == typeof o ? JSON.stringify(o) : o, e + a + ": " + o + "; " }, "");
    e = e.slice(0, -2), console.log(e), GY.Sys.rpt.info(e, !0)
}

function clipText(t, e) { var a = GY.Util.string; return Math.ceil(a.getCStrLen(t) / 2) > e ? a.getSubCString(t, 0, e) + "..." : t }

function setShare(t) { GY.Busi.sns.init(t), GY.Busi.sns.share(t), window.mqq && window.mqq.data.setShareURL({ url: t.link }) }

function pruneObj(t) { return t ? Object.keys(t).reduce(function(e, a) { return null != t[a] && (e[a] = t[a]), e }, {}) : {} }

function showMsgAndRedirect(t) { var e = GY.wd && GY.wd.dialog; return e ? void e.dialog({ msg: t, callback: function() { location.href = "2018fortune.html" } }) : alert(t) }

function handleError() {
    var t = "系统繁忙, 请稍后重试";
    showMsgAndRedirect(t)
}

function handleFail(t) {
    var e = "系统繁忙: " + t.msg + " (" + t.code + ")";
    showMsgAndRedirect(e)
}

function fastClick() {
    var t = function() { try { return document.createEvent("TouchEvent"), !0 } catch (t) { return !1 } }(),
        e = $.fn.on;
    $.fn.on = function() {
        if (/click/.test(arguments[0]) && "function" == typeof arguments[1] && t) {
            var a, o, n = arguments[1];
            e.apply(this, ["touchstart", function(t) { a = t.changedTouches[0].clientX, o = t.changedTouches[0].clientY }]), e.apply(this, ["touchend", function(t) { Math.abs(t.changedTouches[0].clientX - a) > 10 || Math.abs(t.changedTouches[0].clientY - o) > 10 || (t.preventDefault(), n.apply(this, [t])) }])
        } else e.apply(this, arguments);
        return this
    }
}

function UriUtil(t) { this.url = new URL(t) }

function isArray(t) { return "array" === Object.prototype.toString.call(t).slice(8, -1).toLowerCase() }

function addMTA(t) { if (1 != GY.Util.cookie.get("dbg") && (!t || "string" == typeof t || "object" == typeof t)) { var e = {}; "string" == typeof t ? e[t] = "true" : e = t; try { window.MtaH5.clickStat("2018fortune", e) } catch (a) { console.error(a) } } }
var ACT_ID = "2018ny_",
    DOG_LIST = ["土豪汪", "撒粮汪", "颜值汪", "佛系汪", "开挂汪"],
    DATA_DOG = ["财运亨通", "佳偶天成", "倾国倾城", "禅性佛心", "功成名就"],
    LOT_LIST = ["天真无鞋", "不明觉栗", "无欲则刚", "搬砖加班", "出双入对", "人艰不拆", "骨骼清奇", "花见花开", "剁手吃土", "黄金万两"],
    DATA_LOTS = [
        "然而呆到深处自然萌",
        "而且旁人不明，但无不觉厉",
        "而且云淡风轻，上善若水",
        "然而砖友明天见，砖友天天见",
        "而且囤了成吨的狗粮",
        "却只能心疼的抱住孤傲的自己",
        "然而仙风道骨，颜不由衷",
        "而且人见人爱，鸟见鸟呆",
        "然而剁手剁不尽，春风吹又生",
        "而且有钱只是你的超能力之一"
    ],
    DATA_PROJ = [{
            cover: "proj-cover1.jpg",
            title: "有爱任性，云养“大野喵”",
            id: 29272,
            desc: "三江源生活着神秘“大野喵”雪豹，常把牧民的牛羊当大餐。快来云养“大野喵”，补偿牧民损失，让雪豹和牧民过个安心年！",
            aided: "“大野喵”雪豹君",
            receiver: "阿拉善SEE基金会",
            executor: "北京市海淀区山水自然保护中心"
        },
        {
            cover: "proj-cover2.jpg",
            title: "分一点爱给流浪狗狗吧",
            id: 38310,
            desc: "我国一亿只狗1/3以上是流浪狗，每天过着食不果腹的生活。没有家，到哪里都是在流浪。狗年，让流浪狗不流浪。",
            aided: "流浪汪星人",
            receiver: "爱德基金会",
            executor: "北京爱它动物保护公益基金会"
        },
        {
            cover: "proj-cover3.jpg",
            title: "让你的家乡和你一样美",
            id: 28454,
            desc: "回到家乡，记忆中的碧水蓝天还在吗？支持家乡的环保志愿者，让母亲河更清，让垃圾不再围城，让每一口呼吸都洁净",
            aided: "家乡环保人",
            receiver: "上海联劝公益基金会",
            executor: "自然之友"
        },
        {
            cover: "proj-cover4.jpg",
            title: "放鸟们一条生路，护佑它们回家",
            id: 10306,
            desc: "鸟的迁徙像人的“春运”，等待它的若只有日益减少的栖息地、铺天盖地的鸟网和冰冷的猎枪子弹，何处还有鸟的归途？",
            aided: "“春运”路上的鸟群",
            receiver: "阿拉善SEE基金会",
            executor: "阿拉善SEE基金会"
        },
        {
            cover: "proj-cover5.jpg",
            title: "让世界上飞得最高的鸟带你飞",
            id: 38687,
            desc: "斑头雁是世界上飞得最高的鸟，8小时就能飞越喜马拉雅山脉，但每年被大量盗捡鸟蛋，面临濒危，急需受到保护",
            aided: "飞得最高的斑头雁",
            receiver: "中国扶贫基金会",
            executor: "四川省绿色江河环境保护促进会"
        }
    ],
    DATA_SHARE = {
        index: {
            title: "2018你是什么汪",
            desc: "许下新年愿望，用爱心让新年更旺"
        },
        result: {
            title: "<%=nick%>居然是<%=dog%>",
            desc: "<%=nick%>是【<%=lot%>-<%=dog%>】，快来看看2018年你是什么汪？"
        },
        amulet: {
            title: "2018你是什么汪?",
            desc: "<%=lot%> “<%=dog%>” <%=nick%> 与<%=info.aided%>一起祝你新年旺运成双，鸿运当头！"
        }
    },
    EXCLUDE_LOTS = [
        [8, 9],
        [4, 5],
        [6, 7],
        [2, 3],
        [0, 1]
    ],
    BEST_LOT = [9, 4, 7, 2, 1],
    DATA_RESULT_PROMPT = ["听说有爱心的人新年会更旺哦", "听说旺运同享会成双哦"],
    RESOURCE_URL = "//mat1.gtimg.com/gongyi/m/act/2018fortune/",
    DEFAULT_AVATAR = RESOURCE_URL + "avatar.jpg",
    DATA_AMOUNT = [1.68, 6.66, 8.88, 12.88];
window.requestAnimFrame = function() { return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function(t) { window.setTimeout(t, 1e3 / 60) } }(), UriUtil.prototype.removeUriPar = function(t, e) {
        if (!t) return this.url.search = "", this;
        if (e) throw new Error("too many parameters");
        var a = isArray(t) ? t : [t],
            o = this.url.search.slice(1).split("&").filter(function(t) { return a.indexOf(t.split("=")[0]) < 0 }).join("&");
        return this.url.search = o, this
    }, UriUtil.prototype.addUriPar = function(t) { if ("object" != typeof t) return this; var e = $.extend(GY.Util.string.toObj(this.url.search.slice(1)), t); return this.url.search = GY.Util.object.toStr(e), this }, UriUtil.prototype.removeHashPar = function(t, e) {
        if (!t) return this.url.hash = "", this;
        if (e) throw new Error("too many parameters");
        var a = isArray(t) ? t : [t],
            o = this.url.hash.slice(1).split("&").filter(function(t) { return a.indexOf(t.split("=")[0]) < 0 }).join("&");
        return this.url.hash = o, this
    }, UriUtil.prototype.addHashPar = function(t) { if ("object" != typeof t) return this; var e = $.extend(GY.Util.string.toObj(this.url.hash.slice(1)), t); return this.url.hash = GY.Util.object.toStr(e), this },
    function(t, e) {
        function a() {
            function a() {
                for (var t in dt) {
                    var e = document.createElement("audio");
                    e.src = dt[t], e.load(), lt[t] = e
                }
            }

            function s() { lt.bgm.play(), document.addEventListener("WeixinJSBridgeReady", function() { lt.bgm.play(), lt.lots.play(), lt.lots.pause(), lt.cardOut.play(), lt.cardOut.pause() }, !1) }

            function u(t) { for (var e in lt) e != t ? "bgm" != e && lt[e].pause() : (lt[e].currentTime = 0, lt[e].play()) }

            function h() {
                for (var t = Object.keys(it), e = t.length, a = 0, o = 200, n = 0; n < e; n++) {
                    var i = t[n];
                    0 == n && (timeStart = new Date);
                    var r = new Image,
                        s = i.indexOf("avatar") >= 0 ? it[i] : RESOURCE_URL + it[i];
                    ! function(t, n) {
                        var i = "canvas" === n.slice(0, 6);
                        r.onload = function() {
                            if (++a, i && (rt[n.slice(7)] = this), a == e)
                                if (timeLoad = new Date, timeDeta = timeLoad.getTime() - timeStart.getTime(), timeDeta < o) { setTimeout(function() { ut = !0, ht < 180 && (mt = 180) }, o - timeDeta) } else ut = !0, ht < 180 && (mt = 180)
                        }, i && (r.crossOrigin = "anonymous"), r.src = i ? t + "?_" : t
                    }(s, i)
                }
            }

            function b(t) {
                var a = ((new Date).getTime(), document.getElementById("putCanvas")),
                    o = a.getContext("2d"),
                    i = 750,
                    r = 1334,
                    s = 100,
                    d = 270,
                    l = 980,
                    c = 45,
                    u = 466,
                    g = 184,
                    h = 55,
                    m = 642,
                    f = 878,
                    w = 275,
                    b = 4,
                    C = "#B49662",
                    T = 488,
                    j = 580,
                    _ = 562,
                    k = 738,
                    y = 562,
                    A = -18,
                    E = 100,
                    x = w + T + 19,
                    R = 45,
                    U = 6,
                    S = 184,
                    L = 1015,
                    O = "#9E8049",
                    M = 4,
                    D = 67,
                    I = 186,
                    G = 46,
                    F = 30,
                    P = 68,
                    Y = 68,
                    B = 22,
                    q = " 'PingFang SC',tahoma,arial,'helvetica neue','hiragino sans gb','microsoft yahei',sans-serif",
                    $ = function(t, e, a, o, n, i) { t.beginPath(), t.lineWidth = 0, t.moveTo(e, a + i), t.lineTo(e, a + n - i), t.quadraticCurveTo(e, a + n, e + i, a + n), t.lineTo(e + o - i, a + n), t.quadraticCurveTo(e + o, a + n, e + o, a + n - i), t.lineTo(e + o, a + i), t.quadraticCurveTo(e + o, a, e + o - i, a), t.lineTo(e + i, a), t.quadraticCurveTo(e, a, e, a + i), t.closePath() },
                    H = (new Date).getTime();
                vt = H;
                var N = new Image;
                N.id = H, N.onload = function() {
                    if (this.id != vt) return !1;
                    e(a).attr({ width: i, height: r }), o.clearRect(0, 0, i, r), o.fillStyle = "#FFFFFF", o.fillRect(0, 0, i, r);
                    var H = t.bg;
                    o.drawImage(H, 0, 0, H.width, H.height, 0, 0, i, r - s);
                    var W = t.bgGrain;
                    o.drawImage(W, 0, 0, W.width, W.height, 0, 0, i, r - s);
                    var X = t.title;
                    o.drawImage(X, 0, 0, X.width, X.height, (i - u) / 2, h, u, g);
                    var z = (i - m) / 2;
                    o.save(), $(o, z, w, m, f, 30), o.fillStyle = C, o.shadowOffsetX = 0, o.shadowOffsetY = 0, o.shadowBlur = 80, o.shadowColor = "rgba(0,0,0,0.4)", o.fill(), o.restore(), o.save(), $(o, z + b, w + b, m - 2 * b, f - 2 * b, 27), o.clip();
                    var J = t.cardBg;
                    o.drawImage(J, 0, 0, J.width, J.height, z, w, m, f), o.restore();
                    var V = t.cardFront;
                    o.drawImage(V, 0, 0, V.width, V.height, z, w, m, f), o.save(), o.beginPath(), o.rect(0, w, i, T), o.closePath(), o.clip();
                    var K = t["dog" + (parseInt(p) + 1)];
                    o.drawImage(K, 0, 0, K.width, K.height, (i - j) / 2, w + A, j, _), o.restore(), o.drawImage(N, 0, 0, N.width, N.height, (i - k) / 2, w + A, k, y), o.save(), o.beginPath(), o.rect(0, x, i, E), o.closePath(), o.clip();
                    var Q = t.adjective,
                        tt = z + R;
                    o.drawImage(Q, 0, v * E, Q.width, E, tt, x, Q.width, E);
                    var et = t.dogName,
                        at = tt + Q.width + U;
                    o.drawImage(et, 0, p * E, et.width, E, at, x, et.width, E), o.restore(), o.save(), o.beginPath(), o.arc(S, L, M + D, 0, 2 * Math.PI), o.closePath(), o.fillStyle = O, o.fill(), o.restore(), o.save(), o.beginPath(), o.arc(S, L, D, 0, 2 * Math.PI), o.closePath(), o.clip();
                    var ot = t.avatar;
                    o.drawImage(ot, 0, 0, ot.width, ot.height, S - D, L - D, 2 * D, 2 * D), o.restore(), o.font = "bold 28px" + q, o.fillStyle = "#B99B67", o.fillText(t.userName, d, l), o.font = "28px" + q, o.fillText("2018的你" + (n(v) ? "不但" : "虽") + DATA_DOG[p], d, l + c), o.font = "28px" + q, o.fillText(DATA_LOTS[v], d, l + 2 * c);
                    var it = t.logo;
                    o.drawImage(it, 0, 0, it.width, it.height, F, r - s + (s - G) / 2, I, G);
                    var rt = t.qrcode;
                    o.drawImage(rt, 0, 0, rt.width, rt.height, i - B - P, r - s + (s - Y) / 2, P, Y);
                    var st = a.toDataURL("image/png", 1);
                    nt.attr("src", st), Z.addClass("show")
                }, N.crossOrigin = "anonymous";
                var W = v + 1,
                    X = p + 1,
                    z = "dog" + X + "-part" + W + ".png";
                N.src = RESOURCE_URL + z + "?_"
            }

            function C() { e(document).off("touchmove", j), wt = null, At = !1 }

            function j(t) {
                if (console.log("touchmove!"), At) {
                    var e = t.touches[0].pageX,
                        a = t.touches[0].pageY,
                        o = wt - e,
                        n = bt - a;
                    Math.abs(o) > 30 && Math.abs(o) > Math.abs(n) && (C(), o > 0 ? S(t) : L())
                }
            }

            function _(t) { console.log("触摸开始"), wt = t.touches[0].pageX, bt = t.touches[0].pageY, At = !0, e(document).on("touchmove", j) }

            function E(t) {
                if (!Et) return !1;
                var e = t.accelerationIncludingGravity,
                    a = (new Date).getTime();
                if (a - Rt > 500) {
                    var o = a - Rt;
                    Rt = a, Ct = e.x, Tt = e.y, jt = e.z;
                    var n = Math.sqrt((Ct - _t) * (Ct - _t) + (Tt - kt) * (Tt - kt) + (jt - kt) * (jt - kt)),
                        i = n / o * 1e4;
                    i > xt && (Et = !1, U()), _t = Ct, kt = Tt, yt = jt
                }
            }

            function x() { requestAnimFrame(function() { z.addClass("show"), K.addClass("show") }) }

            function R() { H.off("click", R), U() }

            function U() { u("lots"), requestAnimFrame(function() { J.addClass("focus"), W.addClass("leave"), Q.removeClass("show") }), addMTA({ enterpage: "result" }) }

            function S(t) {
                t.stopPropagation();
                var a = e(".result-foot"),
                    o = e(".result-card-wrap,.result-btn-txt,.result-opr");
                o.hasClass("open") || (u("cardFlip"), a.removeClass("show"), o.removeClass("close").addClass("open"), addMTA({ enterpage: "proj" }))
            }

            function L() {
                var t = e(".result-foot"),
                    a = e(".result-card-wrap,.result-btn-txt,.result-opr"),
                    o = e(".j-save-pic");
                a.hasClass("close") || (u("cardFlip"), o.attr("src") && t.addClass("show"), a.removeClass("open").addClass("close"), addMTA({ enterpage: "result" }))
            }

            function O() {
                var a = w + "/cgi-bin/18_new_year_upd_dog",
                    o = { uid: t.user.uid, dog_type: p };
                ajaxEx({ label: "2018fortune抽签", loginState: !0, url: a, data: o, success: function(t) { f = t.sign, v = i(f).lot, M(t), e(".j-proj-open").on("click", S), e(".j-proj-close").on("click", L), e(".j-reset").on("click", function() { Y.addClass("hide"), q.removeClass("show"), addMTA({ result: "again" }) }), b(rt), setShare(d(t.rk)) }, fail: handleFail, error: handleError })
            }

            function M(t) {
                var a = v + 1,
                    o = p + 1,
                    i = "dog" + o + "-part" + a + ".png",
                    r = D(t),
                    s = r.proj;
                e(".j-result-proj-get").html(e(s.receiver === s.executor ? "#tpl-proj-same" : "#tpl-proj-diff").html());
                var d = e(".j-dog"),
                    l = e(".j-dog-title"),
                    c = e(".j-data-dog-desc"),
                    u = e(".j-data-proj-title"),
                    g = e(".j-data-proj-desc"),
                    h = e(".j-data-proj-aided"),
                    m = e(".j-data-proj-reciver"),
                    f = e(".j-data-proj-cover"),
                    w = e(".j-data-proj-executor");
                u.html(s.title), f.attr("src", RESOURCE_URL + s.cover), g.html(s.desc), m.html(s.receiver), w.html(s.executor), h.html(s.aided), d.removeClass("data1 data2 data3 data4 data5").addClass("data" + o), l.removeClass("data1 data2 data3 data4 data5").addClass("data" + o);
                var b = e(".j-data-lots-desc"),
                    C = e(".j-lots-title"),
                    j = e(".j-dog-part"),
                    _ = e(".j-bone-txt"),
                    k = e(".j-result-prompt"),
                    y = e(".j-dialog-thanks");
                c.html(r.dog.desc), b.html(r.lot.desc), k.html(DATA_RESULT_PROMPT[n(v) ? 1 : 0]), C.removeClass("data1 data2 data3 data4 data5 data6 data7 data8 data9 data10").addClass("data" + a), _.removeClass("data1 data2 data3 data4 data5 data6 data7 data8 data9 data10").addClass("data" + a), j.attr("src", RESOURCE_URL + i), e(".result-user-avatar").attr("src", r.avatar), y.html(T("tpl-dialog-thanks", r))
            }

            function D(a) {
                var o = v + 1,
                    i = p + 1,
                    r = RESOURCE_URL + "dog" + i + "-part" + o + ".png",
                    s = DATA_PROJ[p],
                    d = decodeURIComponent(t.user.face || DEFAULT_AVATAR),
                    l = e(".j-bone-txt");
                return l.removeClass("data1 data2 data3 data4 data5 data6 data7 data8 data9 data10").addClass("data" + o), { lot: { id: o, desc: DATA_LOTS[v] }, dog: { id: i, desc: "2018的你" + (n(v) ? "不但" : "虽") + DATA_DOG[p], partUrl: r }, proj: s, avatar: d }
            }
            setShare(l());
            var I = decodeURIComponent(t.user.face || DEFAULT_AVATAR);
            A.nick = clipText(decodeURIComponent(t.user.nick || "爱心网友"), 10), A.avatar = I;
            var G = "yes" == t.Util.uri.getUriPar("retest");
            e(window).on("touchmove", c);
            var F = e(".j-loading"),
                P = e(".index"),
                Y = e(".result"),
                B = e(".bg2"),
                q = e(".bg3"),
                $ = e(".mail-wrap"),
                H = e(".mail"),
                N = e(".mail-bone,.mail-bone-selected,.bone-line"),
                W = e(".mail-bone,.mail-bg,.mail-front,.mail-medal"),
                X = e(".j-mail-medal"),
                z = e(".medal-block"),
                J = e(".mail-bone-selected, .bone-line"),
                V = e(".result-card-wrap,.result-btn-txt,.result-opr"),
                Z = e(".result-foot"),
                K = e(".j-medal-prompt"),
                Q = e(".j-mail-prompt"),
                tt = e(".j-bone-prompt"),
                et = e(".j-dialog-donate"),
                at = (e(".j-dialog-thanks"), e(".dialog-mask")),
                ot = e(".j-donate-input"),
                nt = e(".j-save-pic"),
                it = { adjective: "adjective.png", bgGrain: "bg-grain.png", bgIndex: "bg-index.png", bgmIcon: "bgm-icon.png", bg: "bg.jpg", boneLight: "bone-light.png", bone: "bone.png", btnBone: "btn-bone.png", btnBoneTxt: "btn-bone-txt.png", cardBg: "card-bg.png", cardFront: "card-front-bg.png", cardBackHead: "card-back-head.png", dialogBtnTxt: "dialog-btn-txt.png", dogName: "dog-name.png", logo: "gylogo.png", logoWt: "gylogo-wt.png", indexDog: "index-dog.gif", prompt: "prompt.png", title: "index-title.png", lots: "lots.png", mailBg: "mail-bg.png", mailFront: "mail-front.png", mailRibbon: "medal-ribbon.png", mailRing: "medal-ring.png", medalTxt: "medal-txt.png", medal: "medal.png", paws: "paws.png", dog1: "dog1.png", dog2: "dog2.png", dog3: "dog3.png", dog4: "dog4.png", dog5: "dog5.png", qrcode: "qrcode.png", avatar: I },
                rt = { userName: A.nick },
                st = { "canvas-bg": it.bg, "canvas-bgGrain": it.bgGrain, "canvas-title": it.title, "canvas-cardBg": it.cardBg, "canvas-cardFront": it.cardFront, "canvas-adjective": it.adjective, "canvas-dogName": it.dogName, "canvas-logo": it.logo, "canvas-qrcode": it.qrcode, "canvas-avatar": it.avatar, "canvas-dog1": it.dog1, "canvas-dog2": it.dog2, "canvas-dog3": it.dog3, "canvas-dog4": it.dog4, "canvas-dog5": it.dog5 };
            e.extend(it, st);
            var dt = { bgm: RESOURCE_URL + "audio/BGM.mp3", coin: RESOURCE_URL + "audio/coin.mp3", dogHowl: RESOURCE_URL + "audio/howl.mp3", cardOut: RESOURCE_URL + "audio/out.mp3", cardFlip: RESOURCE_URL + "audio/flip.mp3", dogBarks: RESOURCE_URL + "audio/barks.mp3", lots: RESOURCE_URL + "audio/lots.mp3" },
                lt = {},
                ct = e(".j-bgm-icon");
            a(), lt.bgm.loop = "loop", lt.bgm.ontimeupdate = function() { this.currentTime > 2 && (ct.addClass("show"), this.ontimeupdate = !1) }, ct.on("click", function() { e(this).hasClass("off") ? (e(this).removeClass("off"), lt.bgm.play()) : (e(this).addClass("off"), lt.bgm.pause()) }), s(), e(".index-btn-wrap").on("webkitTransitionEnd", function() { P.css("pointer-events", "auto") });
            var ut = !1,
                gt = e(".index-grain-pic"),
                ht = 0,
                mt = 0,
                ft = 3,
                pt = function() { ut && ht == mt ? (F.addClass("hide"), G ? (P.addClass("hide2"), B.addClass("show2"), x()) : P.addClass("show")) : (ht += ft, 360 == ht && (ht = 0), gt.css("-webkit-transform", "rotate(" + ht + "deg)"), requestAnimFrame(pt)) };
            pt();
            var vt, wt, bt, Ct, Tt, jt, _t, kt, yt, At = !1,
                Et = !1,
                xt = 300,
                Rt = 0;
            Ct = Tt = jt = _t = kt = yt = 0;
            var Ut = window.DeviceMotionEvent;
            Ut ? window.addEventListener("devicemotion", E, !1) : (e(".shake-prompt").hide(), Q.addClass("click").html('<span class="mail-prompt-click">点击红包开启新年旺运</span>')), e(".j-start").on("click", function() { u("dogHowl"), P.removeClass("show").addClass("hide"), B.addClass("show"), addMTA({ enterpage: "wish" }) }), e(".index-mid").on("webkitTransitionEnd", function() { P.hasClass("hide") && (console.log("挂出狗牌"), setTimeout(x, 500)) }), e(".index-logo").on("webkitTransitionEnd", function() { P.hasClass("show") && F.remove() });
            var St = !1,
                Lt = !1;
            e(".j-medal").on("click", function() {
                if (!y && St) {
                    y = !0, u("coin"), St = !1;
                    var t = e(this);
                    p = parseInt(t.data("dog")), console.log("dog: ", p), X.children().removeClass().addClass(t.children().attr("class")), z.removeClass("show").addClass("hide"), t.parent().parent().parent().removeClass("hide").addClass("drop"), $.addClass("show"), N.addClass("show"), Q.addClass("show"), K.removeClass("show"), addMTA({ chosedog: DOG_LIST[p] })
                }
            }), K.on("webkitTransitionEnd", function() { K.hasClass("show") && (St = !0) }), Q.on("webkitTransitionEnd", function(t) { "opacity" === t.propertyName && Q.hasClass("show") && (P.remove(), z.removeClass("drop"), k || (k = !0, O(), Ut ? Et = !0 : H.on("click", R))) }), tt.on("webkitTransitionEnd", function() { tt.hasClass("show") && (Lt = !0) }), e(".bone-line").on("webkitTransitionEnd", function() { e(this).hasClass("focus") && !Y.hasClass("show") && setTimeout(function() { u("cardOut"), q.addClass("show"), $.removeClass("show").addClass("hide"), W.addClass("hide"), Y.addClass("show"), setTimeout(function() { e(document).on("touchstart", _) }, 2500) }, 1e3) }), Y.on("webkitTransitionEnd", function() { e(this).hasClass("result") && e(this).hasClass("hide") && (console.log("样式重置"), k = !1, y = !1, e(document).off("touchstart", _), C(), requestAnimFrame(function() { nt.removeClass("show").attr("src", ""), Y.removeClass("show hide"), V.removeClass("open close"), z.removeClass("hide"), $.removeClass("hide"), N.removeClass("show"), W.removeClass("leave hide"), J.removeClass("focus") }), setTimeout(x, 10)) });
            e(".j-data-lots-desc"), e(".j-lots-title"), e(".j-dog-part"), e(".j-bone-txt");
            m.on("click", ".j-donate", function(t) { u("dogBarks"), ot.val("6.66"), at.addClass("show"), et.show().removeClass("manual").addClass("show"), addMTA({ proj: "donate" }) }), e(".j-dialog-close").on("click", function() { e(this).parent().removeClass("show").hide(), at.removeClass("show") }), e(".j-donate-manual").on("click", function() { et.addClass("manual"), ot.val("").focus() }), e(".j-donate-rand").on("click", function() {
                var t = DATA_AMOUNT.length,
                    e = Math.floor(Math.random() * t);
                ot.val(DATA_AMOUNT[e])
            }), e(".j-pay").on("click", function() {
                var e = DATA_PROJ[p];
                et.hide().removeClass("show"), at.removeClass("show"), o(ot.val()) && t.wd.calm.wPay({ pid: e.id, success: function() { r(e) }, dother: function() { location.href = "/m/weixin/detail.htm?pid=" + e.id } }), addMTA({ proj: "confirm_donate" })
            }), g(), h()
        }

        function o(t) { var e = parseFloat(t); return e >= .01 || (h.dialog({ msg: "请输入有效金额" }), !1) }

        function n(t) { return BEST_LOT.indexOf(t) >= 0 }

        function i(t) {
            var e = LOT_LIST.length - 2,
                a = Math.floor(t / e),
                o = t % e;
            o >= Math.min.apply(Math, EXCLUDE_LOTS[a]) && (o += 2);
            var n = { dog: a, lot: o };
            return console.log("您抽到的签是:", LOT_LIST[n.lot] + "·" + DOG_LIST[n.dog], n), n
        }

        function r(a) {
            var o = e(".j-dialog-donate"),
                n = e(".j-dialog-thanks"),
                i = e(".dialog-mask"),
                r = e(".j-donate-input");
            t.Busi.pay.set({
                success: function(t) { h.hideLoading(), o.removeClass("show"), i.addClass("show"), n.show().addClass("show"), e(".j-get-amulet").on("click", function() { location.href = "2018fortune_amulet.html?transcode=" + t.info.transcode, addMTA({ enterpage: "amulet" }) }), addMTA({ enterpage: "donate_success" }) },
                cancel: function() { h.hideLoading() },
                fail: function(t) {
                    h.hideLoading(), report({ label: "2018fortune捐款失败", "项目id": a.id, ret: t });
                    var e = t.code ? "(" + t.code + ")" : "";
                    h.dialog({ msg: "支付失败: " + t.msg + e })
                },
                safariCallback: function() { h.hideLoading(), h.dialog({ msg: "捐款完成后您可以分享给朋友，请大家一起献爱心", btnText: "查看捐赠结果", callback: function() { t.Busi.pay.gyCheckTradeNo(!0) } }) }
            }), s(a.id, r.val())
        }

        function s(e, a) {
            var o = { money: a, actid: e, oid: t.user.uid, gt: ACT_ID + f };
            C.getUriPar("et") && (o.et = C.getUriPar("et")), t.wd.dialog.loading({ msg: "支付中..." }), t.Busi.pay.paySubmit(o)
        }

        function d(t) {
            var e = "//ssl.gongyi.qq.com/m/wxact/2018fortune_result.html?rk=" + t,
                a = location.protocol + RESOURCE_URL + "share_preview.jpg",
                o = { nick: A.nick, lot: LOT_LIST[v], dog: DOG_LIST[p] };
            return { link: e, title: T(DATA_SHARE.result.title, o), desc: T(DATA_SHARE.result.desc, o), imgUrl: a, img_url: a, success: function() { addMTA({ result: "share" }) } }
        }

        function l() {
            var t = new UriUtil(location.href).removeUriPar(["retest"]).url.href,
                e = location.protocol + RESOURCE_URL + "share_preview.jpg";
            return { link: t, title: DATA_SHARE.index.title, desc: DATA_SHARE.index.desc, imgUrl: e, img_url: e }
        }

        function c(t) { t.preventDefault() }

        function u() {
            var t = document.documentElement.clientWidth || window.innerWidth,
                a = document.documentElement.clientHeight || window.innerHeight,
                o = Math.floor(.9 * Math.max(t, a)) - e(".j-paycalm-head").height() - e(".j-paycalm-foot").height();
            e(".j-paycalm-body").css("max-height", o + "px")
        }

        function g() {
            function t() {
                var t = document.body.clientWidth,
                    e = document.body.clientHeight;
                a = Math.ceil(10 * t / 320), o = (e - 45 - a) / (c.h * t / c.w), i.hasClass("show") && r.css({ transform: "translateY(" + a + "px) scale(" + o + ")", "-webkit-transform": "translateY(" + a + "px) scale(" + o + ")" })
            }
            var a, o, n = !1,
                i = e(".save-wrap"),
                r = e(".save-block"),
                s = e(".flash"),
                d = e(".flash-in"),
                l = e(".flash-out"),
                c = { w: 750, h: 1334 };
            e(window).on("resize", function() { document.body.clientWidth < document.body.clientHeight && t() }), t(), e(".j-share").on("click", function() { return !n && (n = !0, s.addClass("blink"), d.show(), void addMTA({ result: "savepic" })) }), d.on("webkitAnimationEnd", function() { e(this).hide(), l.addClass("blink"), i.addClass("show") }), l.on("webkitAnimationEnd", function() { e(this).removeClass("blink"), s.removeClass("blink"), setTimeout(function() { r.css({ transform: "translateY(" + a + "px) scale(" + o + ")", "-webkit-transform": "translateY(" + a + "px) scale(" + o + ")" }) }, 0) }), e(".j-close-save").on("click", function() { i.removeClass("show"), r.css({ transform: "translateY(0) scale(1)", "-webkit-transform": "translateY(0) scale(1)" }), n = !1 })
        }
        var h, m, f, p, v, w = __CONF__.cgiUrl1,
            b = t.Busi,
            C = t.Util.uri,
            T = (t.Sys.ajax, t.tpl.getHTML),
            j = t.Util.cookie,
            _ = b.authorize,
            k = !1,
            y = !1,
            A = {};
        b.pageInit = function() {
            function a() {
                var t = 100,
                    e = 375,
                    a = document.documentElement.clientWidth || window.innerWidth,
                    o = Math.floor(a / e * t);
                document.querySelector("html").style.fontSize = o + "px"
            }
            h = t.wd.dialog, m = e("#pageContainer"), isWX() && b.js_conf.init();
            var o = navigator.userAgent;
            if (window.androlow = !1, /Android (\d+\.\d+)/.test(o)) {
                var n = parseFloat(RegExp.$1);
                n < 6 && (window.androlow = !0, document.querySelector("html").className = "androLow")
            }
            a(), window.addEventListener("resize", a), window.addEventListener("resize", u), fastClick()
        }, b.action_index = function() { isWX() && !j.get("token") && (t.user.uid = ""), _.login({ snsapi: "snsapi_userinfo", callback: a }) }
    }(GY, Zepto),
    function(t, e) {
        function a(t) {
            var e = { msg: "提交中", timeout: 3e3 };
            !!t && $.extend(e, t), n();
            var a = $("#weui-toast");
            a.attr("id") || ($("body").append(GY.tpl.getHTML("tpl_toast", e)), a = $("#weui-toast")), a.show(), setTimeout(function() { a.hide(), "function" == typeof e.callback && e.callback() }, e.timeout)
        }

        function o(t) {
            var e = $("#weui_loading"),
                a = { msg: "加载中...", isText: 0, mask: 0 };
            !!t && $.extend(a, t), e.attr("id") ? $("#weui_loading").find(".weui_toast_content").html(a.msg) : ($("body").append(GY.tpl.getHTML("tpl_loading", a)), e = $("#weui_loading")), e.show()
        }

        function n() {
            var t = $("#weui_loading");
            t.hide()
        }

        function i(t) {
            n();
            var e = $("#weui_dialog"),
                a = { title: "温馨提示", msg: "系统繁忙，请稍后重试", btnText: "确定" };
            !!t && $.extend(a, t), e.attr("id") || ($("body").append(GY.tpl.getHTML("tpl_dialog", a)), e = $("#weui_dialog"));
            var o = e.find(".weui_btn_dialog"),
                i = e.find(".weui_dialog_title"),
                r = e.find(".weui_dialog_bd");
            a.title ? i.html(a.title) : i.html("温馨提示"), a.msg && r.html(a.msg), a.align && r.attr("style", "text-align:" + a.align), a.btnText ? o.html(a.btnText) : o.html("确定");
            var s = e.find(".primary");
            s.unbind("click"), s.click(function() { e.hide(), "function" == typeof t.callback && a.callback() }), e.show()
        }

        function r(t) {
            var e = $("#weui_confirm"),
                a = { title: "温馨提示", msg: "系统繁忙，请稍后再试", stitle: "确定", ctitle: "取消" };
            !!t && $.extend(a, t), e.attr("id") || ($("body").append(GY.tpl.getHTML("tpl_confirm", a)), e = $("#weui_confirm"));
            var o = e.find(".weui_dialog_title"),
                n = e.find(".weui_dialog_bd"),
                i = e.find(".primary"),
                r = e.find(".default");
            a.title ? o.html(a.title) : o.html("温馨提示"), a.msg && n.html(a.msg), a.stitle ? i.html(a.stitle) : i.html("确定"), a.ctitle ? r.html(a.ctitle) : r.html("取消"), i.off("click"), i.click(function() { "function" == typeof a.callback && a.callback(), e.hide() }), r.off("click"), r.click(function() { "function" == typeof a.cancel && a.cancel(), e.hide() }), e.show()
        }
        t.extend(e, { showToast: a, dialog: i, hideLoading: n, loading: o, confirm: r })
    }(GY, "wd.dialog");
/**
 * @user wjs
 * @time 2018-02-07 11:22
 */